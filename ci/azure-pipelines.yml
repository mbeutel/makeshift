# Azure Pipelines configuration

variables:
  system.debug: true

trigger:
- master
- mr/*

pr:
- master

jobs:
- template: azure-pipelines-job-cmake.yml
  parameters:
    vcpkgRef: e308474b85ff49f2b688a759351c4ec569636910
    vcpkgOverlayRepo: 'https://mp-force.ziti.uni-heidelberg.de/asc/infrastructure/vcpkg-ports.git'
    vcpkgOverlayRef: a08517fb77e9d48d00dd33c16e5acd01f8b31f29
    vcpkgPackages: ['cmakeshift', 'gsl-lite', 'catch2', 'mpark-variant']

    cmakeConfigArgs: '-DMAKESHIFT_BUILD_TESTS=ON'
    cmakeTestArgs: '--exclude-regex "cuda"' # do not run CUDA tests

    targets:

    #- os: Windows
    #  cxxCompiler: MSVC
    #  cxxCompilerVersions: [2019]
    #  platforms: [x86, x64]

    - os: Windows
      cxxCompiler: MSVC
      cxxCompilerVersions: [2019]
      cudaCompiler: NVCC
      #cudaCompilerVersion: 10_2
      cudaCompilerVersion: 10_1
      platforms: [x64]
      cmakeConfigArgs: '-DMAKESHIFT_BUILD_CUDA_TESTS=ON'

    #- os: Windows
    #  cxxCompiler: Clang
    #  cxxCompilerVersions: [9]
    #  platforms: [x86, x64]

    #- os: Linux
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [6, 7, 8, 9]
    #  platforms: [x64]
    #  vcpkgTriplet: <platform>-<os>-sanitize
    #  cmakeConfigArgs: '-DCMAKESHIFT_PRIVATE_COMPILE_SETTINGS=runtime-checks;debug-stdlib'

    #- os: Linux
    #  cxxCompiler: Clang
    #  cxxCompilerVersions: [5, 6, 7, 8, 9]
    #  platforms: [x64]
    #  vcpkgTriplet: <platform>-<os>-sanitize
    #  cmakeConfigArgs: '-DCMAKESHIFT_PRIVATE_COMPILE_SETTINGS=runtime-checks;debug-stdlib'

    - os: Linux
      cxxCompiler: GCC
      cxxCompilerVersions: [9]
      cudaCompiler: NVCC
      cudaCompilerVersion: 10_2
      platforms: [x64]
      cmakeConfigArgs: '-DMAKESHIFT_BUILD_CUDA_TESTS=ON'

    #- os: MacOS
    #  cxxCompiler: GCC
    #  cxxCompilerVersions: [6, 7, 8, 9]
    #  platforms: [x64]

    - os: MacOS
      cxxCompiler: AppleClang
      cxxCompilerVersions: [9_4_1, 10, 10_1, 10_2, 10_2_1, 10_3, 11, 11_1, 11_2, 11_2_1, 11_3]
      platforms: [x64]
